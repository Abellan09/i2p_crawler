
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><title>Python: module manager</title>
<meta charset="utf-8">
</head><body bgcolor="#f0f0f8">

<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="heading">
<tr bgcolor="#7799ee">
<td valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial">&nbsp;<br><big><big><strong>manager</strong></big></big></font></td
><td align=right valign=bottom
><font color="#ffffff" face="helvetica, arial"><a href=".">index</a><br><a href="file:///C:/users/alberto/dropbox/universidad/5.%20tfg/tfg_crawler_i2p/crawler/i2p/manager.py">c:\users\alberto\dropbox\universidad\5. tfg\tfg_crawler_i2p\crawler\i2p\manager.py</a></font></td></tr></table>
    <p><tt>#&nbsp;encoding:&nbsp;utf-8</tt></p>
<p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#aa55cc">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial"><big><strong>Modules</strong></big></font></td></tr>
    
<tr><td bgcolor="#aa55cc"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><table width="100%" summary="list"><tr><td width="25%" valign=top><a href="copy.html">copy</a><br>
<a href="json.html">json</a><br>
<a href="logging.html">logging</a><br>
</td><td width="25%" valign=top><a href="os.html">os</a><br>
<a href="shutil.html">shutil</a><br>
<a href="sqlite3.html">sqlite3</a><br>
</td><td width="25%" valign=top><a href="subprocess.html">subprocess</a><br>
<a href="time.html">time</a><br>
<a href="urlparse.html">urlparse</a><br>
</td><td width="25%" valign=top></td></tr></table></td></tr></table><p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#eeaa77">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial"><big><strong>Functions</strong></big></font></td></tr>
    
<tr><td bgcolor="#eeaa77"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><dl><dt><a name="-add_to_database"><strong>add_to_database</strong></a>(site, targeted_sites)</dt><dd><tt>EN:&nbsp;It&nbsp;adds&nbsp;the&nbsp;extracted&nbsp;data&nbsp;by&nbsp;the&nbsp;crawler&nbsp;to&nbsp;the&nbsp;database.<br>
SP:&nbsp;Añade&nbsp;los&nbsp;datos&nbsp;extraídos&nbsp;por&nbsp;el&nbsp;crawler&nbsp;a&nbsp;la&nbsp;base&nbsp;de&nbsp;datos.<br>
&nbsp;<br>
:param&nbsp;site:&nbsp;site&nbsp;in&nbsp;question&nbsp;to&nbsp;add&nbsp;to&nbsp;the&nbsp;database&nbsp;/&nbsp;site&nbsp;en&nbsp;cuestión&nbsp;a&nbsp;añadir&nbsp;a&nbsp;la&nbsp;base&nbsp;de&nbsp;datos<br>
:param&nbsp;targeted_sites:&nbsp;sites&nbsp;to&nbsp;which&nbsp;the&nbsp;site&nbsp;points&nbsp;at&nbsp;/&nbsp;sitios&nbsp;a&nbsp;los&nbsp;que&nbsp;el&nbsp;site&nbsp;apunta</tt></dd></dl>
 <dl><dt><a name="-check"><strong>check</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;checks&nbsp;if&nbsp;in&nbsp;the&nbsp;/finished&nbsp;directory&nbsp;there&nbsp;are&nbsp;".fail"&nbsp;and/or&nbsp;".ok"&nbsp;files&nbsp;to&nbsp;process.<br>
SP:&nbsp;Comprueba&nbsp;si&nbsp;en&nbsp;el&nbsp;directorio&nbsp;/finished&nbsp;hay&nbsp;ficheros&nbsp;".fail"&nbsp;y/o&nbsp;".ok"&nbsp;que&nbsp;procesar.<br>
&nbsp;<br>
It&nbsp;adds&nbsp;the&nbsp;names&nbsp;of&nbsp;the&nbsp;".ok"&nbsp;and&nbsp;".fail"&nbsp;files&nbsp;to&nbsp;the&nbsp;ok_files&nbsp;and&nbsp;fail_files&nbsp;lists,&nbsp;respectively.<br>
After&nbsp;that,&nbsp;it&nbsp;calls&nbsp;the&nbsp;<a href="#-process_fail">process_fail</a>()&nbsp;and&nbsp;<a href="#-process_ok">process_ok</a>()&nbsp;functions.<br>
Añade&nbsp;los&nbsp;nombres&nbsp;de&nbsp;los&nbsp;ficheros&nbsp;".ok"&nbsp;y&nbsp;".fail"&nbsp;a&nbsp;las&nbsp;listas&nbsp;ok_files&nbsp;y&nbsp;fail_files,&nbsp;respectivamente.<br>
A&nbsp;continuación,&nbsp;llama&nbsp;a&nbsp;las&nbsp;funciones&nbsp;<a href="#-process_fail">process_fail</a>()&nbsp;y&nbsp;<a href="#-process_ok">process_ok</a>().</tt></dd></dl>
 <dl><dt><a name="-db_to_json"><strong>db_to_json</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;generates&nbsp;a&nbsp;file&nbsp;in&nbsp;json&nbsp;format&nbsp;with&nbsp;the&nbsp;nodes&nbsp;and&nbsp;links&nbsp;that&nbsp;are&nbsp;contained&nbsp;in&nbsp;the&nbsp;database.<br>
SP:&nbsp;Genera&nbsp;un&nbsp;archivo&nbsp;en&nbsp;formato&nbsp;json&nbsp;con&nbsp;los&nbsp;nodos&nbsp;y&nbsp;links&nbsp;contenidos&nbsp;en&nbsp;la&nbsp;base&nbsp;de&nbsp;datos.</tt></dd></dl>
 <dl><dt><a name="-dict_factory"><strong>dict_factory</strong></a>(cursor, row)</dt><dd><tt>EN:&nbsp;Function&nbsp;taken&nbsp;from&nbsp;https://docs.python.org/3/library/sqlite3.html#sqlite3.Connection.row_factory<br>
SP:&nbsp;Función&nbsp;tomada&nbsp;de&nbsp;https://docs.python.org/3/library/sqlite3.html#sqlite3.Connection.row_factory</tt></dd></dl>
 <dl><dt><a name="-main"><strong>main</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;controls&nbsp;the&nbsp;whole&nbsp;process&nbsp;of&nbsp;the&nbsp;crawling&nbsp;through&nbsp;a&nbsp;loop&nbsp;that&nbsp;is&nbsp;repeated&nbsp;every&nbsp;2&nbsp;seconds.<br>
SP:&nbsp;Controla&nbsp;todo&nbsp;el&nbsp;proceso&nbsp;del&nbsp;crawling&nbsp;mediante&nbsp;un&nbsp;bucle&nbsp;que&nbsp;se&nbsp;repite&nbsp;cada&nbsp;2&nbsp;segundos.<br>
&nbsp;<br>
Every&nbsp;second&nbsp;it&nbsp;enters&nbsp;the&nbsp;main&nbsp;loop&nbsp;(if&nbsp;there&nbsp;are&nbsp;still&nbsp;sites&nbsp;to&nbsp;visit&nbsp;or&nbsp;sites&nbsp;that&nbsp;are&nbsp;been&nbsp;visited)&nbsp;to&nbsp;crawl&nbsp;all&nbsp;the&nbsp;sites.<br>
Finally,&nbsp;the&nbsp;extracted&nbsp;info&nbsp;is&nbsp;added&nbsp;to&nbsp;the&nbsp;database&nbsp;and&nbsp;the&nbsp;json&nbsp;file&nbsp;that&nbsp;will&nbsp;be&nbsp;used&nbsp;for&nbsp;web&nbsp;visualitation&nbsp;of&nbsp;the&nbsp;node&nbsp;map&nbsp;is&nbsp;generated.<br>
Cada&nbsp;segundo&nbsp;se&nbsp;entra&nbsp;en&nbsp;el&nbsp;bucle&nbsp;principal&nbsp;(si&nbsp;quedan&nbsp;sitios&nbsp;por&nbsp;visitar&nbsp;o&nbsp;se&nbsp;están&nbsp;visitando)&nbsp;para&nbsp;crawlear&nbsp;todos&nbsp;los&nbsp;sites.<br>
Finalmente,&nbsp;la&nbsp;información&nbsp;extraída&nbsp;se&nbsp;añade&nbsp;a&nbsp;la&nbsp;base&nbsp;de&nbsp;datos&nbsp;y&nbsp;se&nbsp;genera&nbsp;el&nbsp;archivo&nbsp;json&nbsp;que&nbsp;se&nbsp;utilizará&nbsp;para&nbsp;la&nbsp;visulación&nbsp;web&nbsp;del&nbsp;mapa&nbsp;de&nbsp;nodos.</tt></dd></dl>
 <dl><dt><a name="-process_fail"><strong>process_fail</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;processes&nbsp;the&nbsp;files&nbsp;with&nbsp;".fail"&nbsp;extension.<br>
SP:&nbsp;Procesa&nbsp;los&nbsp;ficheros&nbsp;con&nbsp;extensión&nbsp;".fail".<br>
&nbsp;<br>
It&nbsp;deletes&nbsp;the&nbsp;files&nbsp;with&nbsp;the&nbsp;".fail"&nbsp;extension&nbsp;from&nbsp;the&nbsp;/finished&nbsp;directory&nbsp;and&nbsp;adds&nbsp;the&nbsp;failed&nbsp;site<br>
to&nbsp;the&nbsp;pending_sites&nbsp;list&nbsp;so&nbsp;that&nbsp;the&nbsp;site&nbsp;can&nbsp;be&nbsp;crawled&nbsp;again.<br>
Elimina&nbsp;los&nbsp;ficheros&nbsp;con&nbsp;extensión&nbsp;".fail"&nbsp;del&nbsp;directorio&nbsp;/finished&nbsp;y&nbsp;añade&nbsp;el&nbsp;site&nbsp;fallido&nbsp;a&nbsp;la&nbsp;lista<br>
pending_sites&nbsp;para&nbsp;que&nbsp;se&nbsp;vuelva&nbsp;a&nbsp;crawlear.</tt></dd></dl>
 <dl><dt><a name="-process_ok"><strong>process_ok</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;processes&nbsp;the&nbsp;files&nbsp;with&nbsp;".ok"&nbsp;extension.<br>
SP:&nbsp;Procesa&nbsp;los&nbsp;ficheros&nbsp;con&nbsp;extensión&nbsp;".ok".<br>
&nbsp;<br>
It&nbsp;moves&nbsp;the&nbsp;".json"&nbsp;files&nbsp;of&nbsp;the&nbsp;sites&nbsp;that&nbsp;have&nbsp;been&nbsp;crawled&nbsp;correctly&nbsp;(.ok)&nbsp;from&nbsp;the&nbsp;/ongoing&nbsp;directory&nbsp;to&nbsp;the&nbsp;/finished<br>
directory,&nbsp;opens&nbsp;said&nbsp;".json"&nbsp;files,&nbsp;calls&nbsp;the&nbsp;<a href="#-add_to_database">add_to_database</a>()&nbsp;function&nbsp;in&nbsp;order&nbsp;to&nbsp;add&nbsp;the&nbsp;pertinent&nbsp;data&nbsp;to&nbsp;database,&nbsp;<br>
adds&nbsp;the&nbsp;sites&nbsp;that&nbsp;haven't&nbsp;been&nbsp;visited&nbsp;yet&nbsp;to&nbsp;the&nbsp;pending_sites&nbsp;and&nbsp;deletes&nbsp;the&nbsp;".ok"&nbsp;files&nbsp;once&nbsp;processed.<br>
Mueve&nbsp;los&nbsp;ficheros&nbsp;".json"&nbsp;de&nbsp;los&nbsp;sites&nbsp;que&nbsp;han&nbsp;sido&nbsp;crawleados&nbsp;correctamente&nbsp;(.ok)&nbsp;del&nbsp;directorio&nbsp;/ongoing&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;al&nbsp;directorio<br>
/finished,&nbsp;abre&nbsp;dichos&nbsp;ficheros&nbsp;".json",&nbsp;llama&nbsp;a&nbsp;la&nbsp;función&nbsp;<a href="#-add_to_database">add_to_database</a>()&nbsp;para&nbsp;añadir&nbsp;los&nbsp;datos&nbsp;pertinentes&nbsp;a&nbsp;la&nbsp;<br>
base&nbsp;de&nbsp;datos,&nbsp;añade&nbsp;a&nbsp;pending_sites&nbsp;los&nbsp;sites&nbsp;que&nbsp;no&nbsp;se&nbsp;hayan&nbsp;visitado&nbsp;y&nbsp;borra&nbsp;los&nbsp;ficheros&nbsp;".ok"&nbsp;una&nbsp;vez&nbsp;procesados.</tt></dd></dl>
 <dl><dt><a name="-results"><strong>results</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;shows&nbsp;some&nbsp;results&nbsp;about&nbsp;the&nbsp;execution&nbsp;of&nbsp;the&nbsp;script.<br>
SP:&nbsp;Muestra&nbsp;algunos&nbsp;resultados&nbsp;sobre&nbsp;la&nbsp;ejecución&nbsp;del&nbsp;script.<br>
&nbsp;<br>
It&nbsp;prints&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;launched&nbsp;crawlers,&nbsp;as&nbsp;well&nbsp;as&nbsp;the&nbsp;total&nbsp;number&nbsp;of&nbsp;executions&nbsp;of&nbsp;the&nbsp;main&nbsp;program&nbsp;loop.<br>
Imprime&nbsp;el&nbsp;número&nbsp;total&nbsp;de&nbsp;crawlers&nbsp;lanzados,&nbsp;así&nbsp;como&nbsp;el&nbsp;número&nbsp;total&nbsp;de&nbsp;ejecuciones&nbsp;del&nbsp;bucle&nbsp;principal&nbsp;del&nbsp;programa.</tt></dd></dl>
 <dl><dt><a name="-set_degree"><strong>set_degree</strong></a>(num)</dt><dd><tt>EN:&nbsp;It&nbsp;assings&nbsp;a&nbsp;certain&nbsp;degree&nbsp;to&nbsp;a&nbsp;site&nbsp;depending&nbsp;on&nbsp;the&nbsp;sites&nbsp;that&nbsp;point&nbsp;at&nbsp;it.<br>
SP:&nbsp;Asigna&nbsp;un&nbsp;determinado&nbsp;grado&nbsp;a&nbsp;un&nbsp;site&nbsp;en&nbsp;función&nbsp;de&nbsp;los&nbsp;sites&nbsp;que&nbsp;lo&nbsp;apuntan.<br>
&nbsp;<br>
:param&nbsp;num:&nbsp;number&nbsp;of&nbsp;sites&nbsp;that&nbsp;point&nbsp;to&nbsp;the&nbsp;site&nbsp;/&nbsp;número&nbsp;de&nbsp;sitios&nbsp;que&nbsp;apuntan&nbsp;al&nbsp;site<br>
:return:&nbsp;the&nbsp;assigned&nbsp;degree&nbsp;/&nbsp;el&nbsp;grado&nbsp;asignado</tt></dd></dl>
 <dl><dt><a name="-throw_crawler"><strong>throw_crawler</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;runs&nbsp;an&nbsp;instance&nbsp;of&nbsp;spider.py&nbsp;(if&nbsp;applicable).<br>
SP:&nbsp;Lanza&nbsp;una&nbsp;instancia&nbsp;de&nbsp;spider.py&nbsp;(si&nbsp;procede).<br>
&nbsp;<br>
If&nbsp;the&nbsp;maximum&nbsp;number&nbsp;of&nbsp;allowed&nbsp;concurrent&nbsp;crawlers&nbsp;has&nbsp;not&nbsp;been&nbsp;exceeded,&nbsp;a&nbsp;subprocess&nbsp;of&nbsp;spider.py&nbsp;is<br>
launched&nbsp;to&nbsp;crawl&nbsp;the&nbsp;next&nbsp;contained&nbsp;eepsite&nbsp;in&nbsp;the&nbsp;pending_sites&nbsp;list.<br>
Si&nbsp;no&nbsp;se&nbsp;ha&nbsp;sobrepasado&nbsp;el&nbsp;número&nbsp;máximo&nbsp;de&nbsp;crawlers&nbsp;concurrentes&nbsp;permitidos,&nbsp;se&nbsp;lanza&nbsp;un&nbsp;subproceso&nbsp;de&nbsp;<br>
spider.py&nbsp;para&nbsp;crawlear&nbsp;el&nbsp;siguiente&nbsp;eepsite&nbsp;contenido&nbsp;en&nbsp;la&nbsp;lista&nbsp;pending_sites.</tt></dd></dl>
 <dl><dt><a name="-update_degree_to_database"><strong>update_degree_to_database</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;updates&nbsp;the&nbsp;degree&nbsp;value&nbsp;for&nbsp;each&nbsp;site&nbsp;in&nbsp;the&nbsp;database.<br>
SP:&nbsp;Actualiza&nbsp;el&nbsp;valor&nbsp;de&nbsp;degree&nbsp;para&nbsp;cada&nbsp;site&nbsp;en&nbsp;la&nbsp;base&nbsp;de&nbsp;datos.</tt></dd></dl>
 <dl><dt><a name="-update_top"><strong>update_top</strong></a>()</dt><dd><tt>EN:&nbsp;It&nbsp;updates&nbsp;the&nbsp;TOP&nbsp;tables&nbsp;of&nbsp;sites&nbsp;with&nbsp;more&nbsp;incoming_sites&nbsp;(Table&nbsp;Incoming_Top)&nbsp;and&nbsp;with&nbsp;more&nbsp;outgoing_sites&nbsp;(Table&nbsp;Outgoing_Top).<br>
SP:&nbsp;Actualiza&nbsp;las&nbsp;tablas&nbsp;de&nbsp;los&nbsp;TOP&nbsp;de&nbsp;sites&nbsp;con&nbsp;más&nbsp;incoming_sites&nbsp;(Tabla&nbsp;Incoming_Top)&nbsp;y&nbsp;con&nbsp;más&nbsp;outgoing_sites&nbsp;(Tabla&nbsp;Outgoing_Top).</tt></dd></dl>
</td></tr></table><p>
<table width="100%" cellspacing=0 cellpadding=2 border=0 summary="section">
<tr bgcolor="#55aa55">
<td colspan=3 valign=bottom>&nbsp;<br>
<font color="#ffffff" face="helvetica, arial"><big><strong>Data</strong></big></font></td></tr>
    
<tr><td bgcolor="#55aa55"><tt>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</tt></td><td>&nbsp;</td>
<td width="100%"><strong>attempts_dict</strong> = {}<br>
<strong>fail_files</strong> = []<br>
<strong>ignored_sites</strong> = []<br>
<strong>maximum_crawlers</strong> = 20<br>
<strong>ok_files</strong> = []<br>
<strong>ongoing_crawlers</strong> = 0<br>
<strong>ongoing_sites</strong> = []<br>
<strong>pending_sites</strong> = ['auchan.i2p', 'city.i2p', 'mochimochi.i2p', 'wa11ed.city.i2p', '102chan.i2p', '1st.i2p', '333.i2p', 'alice.i2p', 'andmp.i2p', 'animal.i2p', 'anodex.i2p', 'anongw.i2p', 'anoncoin.i2p', 'aosp.i2p', 'arc2.i2p', 'archaicbinarybbs.i2p', 'archiv.tutorials.i2p', 'backup.i2p', 'bigbrother.i2p', 'bitlox.i2p', ...]<br>
<strong>seed_sites</strong> = ['auchan.i2p', 'city.i2p', 'mochimochi.i2p', 'wa11ed.city.i2p', '102chan.i2p', '1st.i2p', '333.i2p', 'alice.i2p', 'andmp.i2p', 'animal.i2p', 'anodex.i2p', 'anongw.i2p', 'anoncoin.i2p', 'aosp.i2p', 'arc2.i2p', 'archaicbinarybbs.i2p', 'archiv.tutorials.i2p', 'backup.i2p', 'bigbrother.i2p', 'bitlox.i2p', ...]<br>
<strong>total_crawlers</strong> = 0<br>
<strong>total_loop_executions</strong> = 0<br>
<strong>visited_sites</strong> = []</td></tr></table>
</body></html>